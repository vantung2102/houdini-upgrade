/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


// License: LGPL-3.0-or-later
/* this file expects a config/config.json that contains
{ "button":{
    "url":"https://commitchange.com",
    "css":"https://s3-us-west-1.amazonaws.com/commitchange/manual/donate-button.v2.css"
  }
}

 this file is generated by rails when compiling the assets
*/

function on_ios11() {
  var userAgent = window.navigator.userAgent;
  var has11 = userAgent.search("OS 11_\\d") > 0;
  var hasMacOS = userAgent.search(" like Mac OS X") > 0;

  return has11 && hasMacOS;
}

window.commitchange = {
  iframes: [],
  modalIframe: null
};

commitchange.getParamsFromUrl = function (whitelist) {
  var result = {},
      tmp = [];
  var items = location.search.substr(1).split("&");
  for (var index = 0; index < items.length; index++) {
    tmp = items[index].split("=");
    if (whitelist.indexOf(tmp[0])) result[tmp[0]] = decodeURIComponent(tmp[1]);
  }
  return result;
};

commitchange.openDonationModal = function (iframe, overlay) {
  return function (event) {
    overlay.className = 'commitchange-overlay commitchange-open';
    iframe.className = 'commitchange-iframe commitchange-open';
    if (on_ios11()) {
      iframe.style.position = 'absolute';
    }
    commitchange.setParams(commitchange.getParamsFromButton(event.currentTarget), iframe);
    if (on_ios11()) {
      iframe.scrollIntoView();
    }

    commitchange.open_iframe = iframe;
    commitchange.open_overlay = overlay;
  };
};

// Dynamically set the params of the appended iframe donate window
commitchange.setParams = function (params, iframe) {
  params.command = 'setDonationParams';
  params.sender = 'commitchange';
  iframe.contentWindow.postMessage(JSON.stringify(params), fullHost);
};

commitchange.hideDonation = function () {
  if (!commitchange.open_overlay || !commitchange.open_iframe) return;
  commitchange.open_overlay.className = 'commitchange-overlay commitchange-closed';
  commitchange.open_iframe.className = 'commitchange-iframe commitchange-closed';
  if (on_ios11()) {
    commitchange.open_iframe.style.position = 'fixed';
  }
  commitchange.open_overlay = undefined;
  commitchange.open_iframe = undefined;
};

var fullHost = 'http://localhost:5000';

commitchange.overlay = function () {
  var div = document.createElement('div');
  div.setAttribute('class', 'commitchange-closed commitchange-overlay');
  return div;
};

commitchange.createIframe = function (source) {
  var i = document.createElement('iframe');
  var url = document.location.href;
  i.setAttribute('class', 'commitchange-closed commitchange-iframe');
  i.src = source + "&origin=" + url;
  return i;
};

// Given a button with a bunch of data parameters
// return an object of key/vals corresponing to each param
commitchange.getParamsFromButton = function (elem) {
  var options = {
    offsite: 't',
    type: elem.getAttribute('data-type'),
    custom_amounts: elem.getAttribute('data-custom-amounts') || elem.getAttribute('data-amounts'),
    amount: elem.getAttribute('data-amount'),
    minimal: elem.getAttribute('data-minimal'),
    weekly: elem.getAttribute('data-weekly'),
    default: elem.getAttribute('data-default'),
    custom_fields: elem.getAttribute('data-custom-fields'),
    campaign_id: elem.getAttribute('data-campaign-id'),
    gift_option_id: elem.getAttribute('data-gift-option-id'),
    redirect: elem.getAttribute('data-redirect'),
    designation: elem.getAttribute('data-designation'),
    multiple_designations: elem.getAttribute('data-multiple-designations'),
    hide_dedication: elem.getAttribute('data-hide-dedication') ? true : false,
    designations_prompt: elem.getAttribute('data-designations-prompt'),
    single_amount: elem.getAttribute('data-single-amount'),
    designation_desc: elem.getAttribute('data-designation-desc') || elem.getAttribute('data-description'),
    locale: elem.getAttribute('data-locale'),
    "utm_source": elem.getAttribute('data-utm_source'),
    "utm_campaign": elem.getAttribute('data-utm_campaign'),
    "utm_medium": elem.getAttribute('data-utm_medium'),
    "utm_content": elem.getAttribute('data-utm_content'),
    "first_name": elem.getAttribute('data-first_name'),
    "last_name": elem.getAttribute('data-last_name'),
    "country": elem.getAttribute('data-country'),
    "postal_code": elem.getAttribute('data-postal_code')
    // Remove false values from the options
  };for (var key in options) {
    if (!options[key]) delete options[key];
  }
  return options;
};

commitchange.appendMarkup = function () {
  if (commitchange.alreadyAppended) return;else commitchange.alreadyAppended = true;
  var script = document.getElementById('commitchange-donation-script') || document.getElementById('commitchange-script');
  var nonprofitID = script.getAttribute('data-npo-id');
  var baseSource = fullHost + "/nonprofits/" + nonprofitID + "/donate?offsite=t";
  var elems = document.querySelectorAll('.commitchange-donate');

  for (var i = 0; i < elems.length; ++i) {
    var elem = elems[i];
    var source = baseSource;

    var optionsButton = commitchange.getParamsFromButton(elem);
    var options = commitchange.getParamsFromUrl(["utm_campaign", "utm_content", "utm_source", "utm_medium", "first_name", "last_name", "country", "postal_code", "address", "city"]);
    for (var attr in optionsButton) {
      options[attr] = optionsButton[attr];
    }
    var params = [];
    for (var key in options) {
      params.push(key + '=' + options[key]);
    }
    source += "&" + params.join("&");

    if (elem.hasAttribute('data-embedded')) {
      source += '&mode=embedded';
      var iframe = commitchange.createIframe(source);
      elem.appendChild(iframe);
      iframe.setAttribute('class', 'commitchange-iframe-embedded');
      commitchange.iframes.push(iframe);
    } else {
      // Show the CommitChange-branded button if it's not set to custom.
      if (!elem.hasAttribute('data-custom') && !elem.hasAttribute('data-custom-button')) {
        var btn_iframe = document.createElement('iframe');
        var btn_src = fullHost + "/nonprofits/" + nonprofitID + "/btn";
        if (elem.hasAttribute('data-fixed')) {
          btn_src += '?fixed=t';
        }
        btn_iframe.src = btn_src;
        btn_iframe.className = 'commitchange-btn-iframe';
        btn_iframe.setAttribute('scrolling', 'no');
        btn_iframe.setAttribute('seamless', 'seamless');
        elem.appendChild(btn_iframe);
        btn_iframe.onclick = commitchange.openDonationModal(_iframe, overlay);
      }
      // Create the iframe overlay for this button
      var modal = document.createElement('div');
      modal.className = 'commitchange-modal';
      var overlay = commitchange.overlay();
      var _iframe = void 0;
      if (commitchange.modalIframe) {
        _iframe = commitchange.modalIframe;
      } else {
        _iframe = commitchange.createIframe(source);
        commitchange.iframes.push(_iframe);
        commitchange.modalIframe = _iframe;
      }
      modal.appendChild(overlay);
      document.body.appendChild(_iframe);
      elem.parentNode.appendChild(modal);
      overlay.onclick = commitchange.hideDonation;
      elem.onclick = commitchange.openDonationModal(_iframe, overlay);
    } // end else
  } // end for loop
};

// Load the CSS for the parent page element from our AWS server
commitchange.loadStylesheet = function () {
  if (commitchange.alreadyStyled) return;else commitchange.alreadyStyled = true;
  var stylesheet = document.createElement('link');
  stylesheet.href = "http://localhost:5000/css/donate-button.v2.css";
  stylesheet.rel = 'stylesheet';
  stylesheet.type = 'text/css';
  document.getElementsByTagName('head')[0].appendChild(stylesheet);
};

// Handle iframe post messages
if (window.addEventListener) {
  window.addEventListener('message', function (e) {
    // Close the modal
    if (e.data === 'commitchange:close') {
      commitchange.hideDonation();
    }
    // Redirect on donation completion using the redirect param
    else if (e.data.match(/^commitchange:redirect/)) {
        var matches = e.data.match(/^commitchange:redirect:(.+)$/);
        if (matches.length === 2) window.location.href = matches[1];
      }
  });
}

// Make initialization calls on document load
if (document.addEventListener) {
  document.addEventListener("DOMContentLoaded", function (event) {
    commitchange.loadStylesheet();
    commitchange.appendMarkup();
  });
} else if (window.jQuery) {
  window.jQuery(document).ready(function () {
    commitchange.loadStylesheet();
    commitchange.appendMarkup();
  });
} else {
  window.onload = function () {
    commitchange.loadStylesheet();
    commitchange.appendMarkup();
  };
}

if (document.querySelector('.commitchange-donate')) {
  commitchange.loadStylesheet();
  commitchange.appendMarkup();
}

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgOGRkMzU3Mjc5ZWZhMmQ3NjM2NTkiLCJ3ZWJwYWNrOi8vLy4vY2xpZW50L2pzL3dpZGdldC9kb25hdGUtYnV0dG9uLnYyLmpzIl0sIm5hbWVzIjpbInVzZXJBZ2VudCIsIndpbmRvdyIsImhhczExIiwiaGFzTWFjT1MiLCJpZnJhbWVzIiwibW9kYWxJZnJhbWUiLCJjb21taXRjaGFuZ2UiLCJyZXN1bHQiLCJ0bXAiLCJpdGVtcyIsImxvY2F0aW9uIiwiaW5kZXgiLCJ3aGl0ZWxpc3QiLCJkZWNvZGVVUklDb21wb25lbnQiLCJvdmVybGF5IiwiaWZyYW1lIiwiZXZlbnQiLCJwYXJhbXMiLCJKU09OIiwiZnVsbEhvc3QiLCJkaXYiLCJkb2N1bWVudCIsImkiLCJ1cmwiLCJzb3VyY2UiLCJvcHRpb25zIiwib2Zmc2l0ZSIsInR5cGUiLCJlbGVtIiwiY3VzdG9tX2Ftb3VudHMiLCJhbW91bnQiLCJtaW5pbWFsIiwid2Vla2x5IiwiZGVmYXVsdCIsImN1c3RvbV9maWVsZHMiLCJjYW1wYWlnbl9pZCIsImdpZnRfb3B0aW9uX2lkIiwicmVkaXJlY3QiLCJkZXNpZ25hdGlvbiIsIm11bHRpcGxlX2Rlc2lnbmF0aW9ucyIsImhpZGVfZGVkaWNhdGlvbiIsImRlc2lnbmF0aW9uc19wcm9tcHQiLCJzaW5nbGVfYW1vdW50IiwiZGVzaWduYXRpb25fZGVzYyIsImxvY2FsZSIsInNjcmlwdCIsIm5vbnByb2ZpdElEIiwiYmFzZVNvdXJjZSIsImVsZW1zIiwib3B0aW9uc0J1dHRvbiIsImtleSIsImJ0bl9pZnJhbWUiLCJidG5fc3JjIiwibW9kYWwiLCJzdHlsZXNoZWV0IiwiZSIsIm1hdGNoZXMiXSwibWFwcGluZ3MiOiI7QUFBQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7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O0FBQ0FBO0FBQ0FqQztBQVBGZjs7QUFXQTtBQUNBLElBQUdMLE9BQUgsa0JBQTRCO0FBQzFCQSxxQ0FBbUMsYUFBTztBQUN4QztBQUNBLFFBQUdzRCxXQUFILHNCQUFvQztBQUNsQ2pEO0FBQ0Q7QUFDRDtBQUhBLFNBSUssSUFBR2lELGFBQUgsd0JBQUdBLENBQUgsRUFBMkM7QUFDOUMsWUFBTUMsVUFBVUQsYUFBaEIsOEJBQWdCQSxDQUFoQjtBQUNBLFlBQUdDLG1CQUFILEdBQXlCdkQsdUJBQXVCdUQsUUFBdkJ2RCxDQUF1QnVELENBQXZCdkQ7QUFDMUI7QUFUSEE7QUFXRDs7QUFFRDtBQUNBLElBQUdvQixTQUFILGtCQUE4QjtBQUM1QkEsZ0RBQThDLGlCQUFXO0FBQ3ZEZjtBQUNBQTtBQUZGZTtBQURGLE9BS08sSUFBR3BCLE9BQUgsUUFBa0I7QUFDdkJBLGdDQUE4QixZQUFNO0FBQ2xDSztBQUNBQTtBQUZGTDtBQURLLE9BS0E7QUFDTEEsa0JBQWdCLFlBQU07QUFDcEJLO0FBQ0FBO0FBRkZMO0FBSUQ7O0FBRUQsSUFBR29CLHVCQUFILHNCQUFHQSxDQUFILEVBQW1EO0FBQ2pEZjtBQUNBQTtBQUNELEMiLCJmaWxlIjoiZG9uYXRlLWJ1dHRvbi52Mi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDhkZDM1NzI3OWVmYTJkNzYzNjU5IiwiLy8gTGljZW5zZTogTEdQTC0zLjAtb3ItbGF0ZXJcbi8qIHRoaXMgZmlsZSBleHBlY3RzIGEgY29uZmlnL2NvbmZpZy5qc29uIHRoYXQgY29udGFpbnNcbnsgXCJidXR0b25cIjp7XG4gICAgXCJ1cmxcIjpcImh0dHBzOi8vY29tbWl0Y2hhbmdlLmNvbVwiLFxuICAgIFwiY3NzXCI6XCJodHRwczovL3MzLXVzLXdlc3QtMS5hbWF6b25hd3MuY29tL2NvbW1pdGNoYW5nZS9tYW51YWwvZG9uYXRlLWJ1dHRvbi52Mi5jc3NcIlxuICB9XG59XG5cbiB0aGlzIGZpbGUgaXMgZ2VuZXJhdGVkIGJ5IHJhaWxzIHdoZW4gY29tcGlsaW5nIHRoZSBhc3NldHNcbiovXG5cblxuZnVuY3Rpb24gb25faW9zMTEoKSB7XG4gIHZhciB1c2VyQWdlbnQgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgdmFyIGhhczExID0gdXNlckFnZW50LnNlYXJjaChcIk9TIDExX1xcXFxkXCIpID4gMFxuICB2YXIgaGFzTWFjT1MgPSB1c2VyQWdlbnQuc2VhcmNoKFwiIGxpa2UgTWFjIE9TIFhcIikgPiAwXG5cbiAgcmV0dXJuIGhhczExICYmIGhhc01hY09TO1xufVxuXG53aW5kb3cuY29tbWl0Y2hhbmdlID0ge1xuICBpZnJhbWVzOiBbXVxuLCBtb2RhbElmcmFtZTogbnVsbFxufVxuXG5jb21taXRjaGFuZ2UuZ2V0UGFyYW1zRnJvbVVybCA9ICh3aGl0ZWxpc3QpID0+IHtcbiAgICB2YXIgcmVzdWx0ID0ge30sXG4gICAgICAgIHRtcCA9IFtdO1xuICAgIHZhciBpdGVtcyA9IGxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkuc3BsaXQoXCImXCIpO1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBpdGVtcy5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdG1wID0gaXRlbXNbaW5kZXhdLnNwbGl0KFwiPVwiKTtcbiAgICAgICAgaWYgKHdoaXRlbGlzdC5pbmRleE9mKHRtcFswXSkpIHJlc3VsdFt0bXBbMF1dID0gZGVjb2RlVVJJQ29tcG9uZW50KHRtcFsxXSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmNvbW1pdGNoYW5nZS5vcGVuRG9uYXRpb25Nb2RhbCA9IChpZnJhbWUsIG92ZXJsYXkpID0+IHtcbiAgcmV0dXJuIChldmVudCkgPT4ge1xuICAgIG92ZXJsYXkuY2xhc3NOYW1lID0gJ2NvbW1pdGNoYW5nZS1vdmVybGF5IGNvbW1pdGNoYW5nZS1vcGVuJ1xuICAgIGlmcmFtZS5jbGFzc05hbWUgPSAnY29tbWl0Y2hhbmdlLWlmcmFtZSBjb21taXRjaGFuZ2Utb3BlbidcbiAgICBpZiAob25faW9zMTEoKSkge1xuICAgICAgICBpZnJhbWUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnXG4gICAgfVxuICAgIGNvbW1pdGNoYW5nZS5zZXRQYXJhbXMoY29tbWl0Y2hhbmdlLmdldFBhcmFtc0Zyb21CdXR0b24oZXZlbnQuY3VycmVudFRhcmdldCksIGlmcmFtZSlcbiAgICBpZiAob25faW9zMTEoKSkge1xuICAgICAgICBpZnJhbWUuc2Nyb2xsSW50b1ZpZXcoKVxuICAgIH1cblxuICAgIGNvbW1pdGNoYW5nZS5vcGVuX2lmcmFtZSA9IGlmcmFtZVxuICAgIGNvbW1pdGNoYW5nZS5vcGVuX292ZXJsYXkgPSBvdmVybGF5XG4gIH1cbn1cblxuLy8gRHluYW1pY2FsbHkgc2V0IHRoZSBwYXJhbXMgb2YgdGhlIGFwcGVuZGVkIGlmcmFtZSBkb25hdGUgd2luZG93XG5jb21taXRjaGFuZ2Uuc2V0UGFyYW1zID0gKHBhcmFtcywgaWZyYW1lKSA9PiB7XG4gIHBhcmFtcy5jb21tYW5kID0gJ3NldERvbmF0aW9uUGFyYW1zJ1xuICBwYXJhbXMuc2VuZGVyID0gJ2NvbW1pdGNoYW5nZSdcbiAgaWZyYW1lLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkocGFyYW1zKSwgZnVsbEhvc3QpXG59XG5cbmNvbW1pdGNoYW5nZS5oaWRlRG9uYXRpb24gPSAoKSA9PiB7XG4gIGlmKCFjb21taXRjaGFuZ2Uub3Blbl9vdmVybGF5IHx8ICFjb21taXRjaGFuZ2Uub3Blbl9pZnJhbWUpIHJldHVyblxuICBjb21taXRjaGFuZ2Uub3Blbl9vdmVybGF5LmNsYXNzTmFtZSA9ICdjb21taXRjaGFuZ2Utb3ZlcmxheSBjb21taXRjaGFuZ2UtY2xvc2VkJ1xuICBjb21taXRjaGFuZ2Uub3Blbl9pZnJhbWUuY2xhc3NOYW1lID0gJ2NvbW1pdGNoYW5nZS1pZnJhbWUgY29tbWl0Y2hhbmdlLWNsb3NlZCdcbiAgaWYgKG9uX2lvczExKCkpIHtcbiAgICAgIGNvbW1pdGNoYW5nZS5vcGVuX2lmcmFtZS5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCdcbiAgfVxuICBjb21taXRjaGFuZ2Uub3Blbl9vdmVybGF5ID0gdW5kZWZpbmVkXG4gIGNvbW1pdGNoYW5nZS5vcGVuX2lmcmFtZSA9IHVuZGVmaW5lZFxufVxuXG5jb25zdCBmdWxsSG9zdCA9ICdSRVBMQUNFX0ZVTExfSE9TVCcgXG5cbmNvbW1pdGNoYW5nZS5vdmVybGF5ID0gKCkgPT4ge1xuICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgZGl2LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY29tbWl0Y2hhbmdlLWNsb3NlZCBjb21taXRjaGFuZ2Utb3ZlcmxheScpXG4gIHJldHVybiBkaXZcbn1cblxuY29tbWl0Y2hhbmdlLmNyZWF0ZUlmcmFtZSA9IChzb3VyY2UpID0+IHtcbiAgbGV0IGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKVxuICBjb25zdCB1cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmXG4gIGkuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjb21taXRjaGFuZ2UtY2xvc2VkIGNvbW1pdGNoYW5nZS1pZnJhbWUnKVxuICBpLnNyYyA9IHNvdXJjZSArIFwiJm9yaWdpbj1cIiArIHVybFxuICByZXR1cm4gaVxufVxuXG4vLyBHaXZlbiBhIGJ1dHRvbiB3aXRoIGEgYnVuY2ggb2YgZGF0YSBwYXJhbWV0ZXJzXG4vLyByZXR1cm4gYW4gb2JqZWN0IG9mIGtleS92YWxzIGNvcnJlc3BvbmluZyB0byBlYWNoIHBhcmFtXG5jb21taXRjaGFuZ2UuZ2V0UGFyYW1zRnJvbUJ1dHRvbiA9IChlbGVtKSA9PiB7XG4gIGxldCBvcHRpb25zID0ge1xuICAgIG9mZnNpdGU6ICd0J1xuICAsIHR5cGU6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXR5cGUnKVxuICAsIGN1c3RvbV9hbW91bnRzOiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1jdXN0b20tYW1vdW50cycpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWFtb3VudHMnKVxuICAsIGFtb3VudDogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtYW1vdW50JylcbiAgLCBtaW5pbWFsOiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1taW5pbWFsJylcbiAgLCB3ZWVrbHk6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXdlZWtseScpXG4gICwgZGVmYXVsdDogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGVmYXVsdCcpXG4gICwgY3VzdG9tX2ZpZWxkczogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtY3VzdG9tLWZpZWxkcycpXG4gICwgY2FtcGFpZ25faWQ6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWNhbXBhaWduLWlkJylcbiAgLCBnaWZ0X29wdGlvbl9pZDogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZ2lmdC1vcHRpb24taWQnKVxuICAsIHJlZGlyZWN0OiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1yZWRpcmVjdCcpXG4gICwgZGVzaWduYXRpb246IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWRlc2lnbmF0aW9uJylcbiAgLCBtdWx0aXBsZV9kZXNpZ25hdGlvbnM6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLW11bHRpcGxlLWRlc2lnbmF0aW9ucycpXG4gICwgaGlkZV9kZWRpY2F0aW9uOiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1oaWRlLWRlZGljYXRpb24nKT8gdHJ1ZSA6IGZhbHNlXG4gICwgZGVzaWduYXRpb25zX3Byb21wdDogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGVzaWduYXRpb25zLXByb21wdCcpXG4gICwgc2luZ2xlX2Ftb3VudDogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2luZ2xlLWFtb3VudCcpXG4gICwgZGVzaWduYXRpb25fZGVzYzogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtZGVzaWduYXRpb24tZGVzYycpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWRlc2NyaXB0aW9uJylcbiAgLCBsb2NhbGU6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLWxvY2FsZScpXG4gICwgXCJ1dG1fc291cmNlXCI6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXV0bV9zb3VyY2UnKVxuICAsIFwidXRtX2NhbXBhaWduXCI6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXV0bV9jYW1wYWlnbicpXG4gICwgXCJ1dG1fbWVkaXVtXCI6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXV0bV9tZWRpdW0nKVxuICAsIFwidXRtX2NvbnRlbnRcIjogZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdXRtX2NvbnRlbnQnKVxuICAsIFwiZmlyc3RfbmFtZVwiOiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1maXJzdF9uYW1lJylcbiAgLCBcImxhc3RfbmFtZVwiOiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1sYXN0X25hbWUnKVxuICAsIFwiY291bnRyeVwiOiBlbGVtLmdldEF0dHJpYnV0ZSgnZGF0YS1jb3VudHJ5JylcbiAgLCBcInBvc3RhbF9jb2RlXCI6IGVsZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXBvc3RhbF9jb2RlJylcblxuXG4gIH1cbiAgLy8gUmVtb3ZlIGZhbHNlIHZhbHVlcyBmcm9tIHRoZSBvcHRpb25zXG4gIGZvcihsZXQga2V5IGluIG9wdGlvbnMpIHtcbiAgICBpZighb3B0aW9uc1trZXldKSBkZWxldGUgb3B0aW9uc1trZXldXG4gIH1cbiAgcmV0dXJuIG9wdGlvbnNcbn1cblxuY29tbWl0Y2hhbmdlLmFwcGVuZE1hcmt1cCA9ICgpID0+IHtcbiAgaWYoY29tbWl0Y2hhbmdlLmFscmVhZHlBcHBlbmRlZCkgcmV0dXJuXG4gIGVsc2UgY29tbWl0Y2hhbmdlLmFscmVhZHlBcHBlbmRlZCA9IHRydWVcbiAgbGV0IHNjcmlwdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21taXRjaGFuZ2UtZG9uYXRpb24tc2NyaXB0JykgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1pdGNoYW5nZS1zY3JpcHQnKVxuICBjb25zdCBub25wcm9maXRJRCA9IHNjcmlwdC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbnBvLWlkJylcbiAgY29uc3QgYmFzZVNvdXJjZSA9IGZ1bGxIb3N0ICsgXCIvbm9ucHJvZml0cy9cIiArIG5vbnByb2ZpdElEICsgXCIvZG9uYXRlP29mZnNpdGU9dFwiXG4gIGxldCBlbGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb21taXRjaGFuZ2UtZG9uYXRlJylcblxuICBmb3IobGV0IGkgPSAwOyBpIDwgZWxlbXMubGVuZ3RoOyArK2kpIHtcbiAgICBsZXQgZWxlbSA9IGVsZW1zW2ldXG4gICAgbGV0IHNvdXJjZSA9IGJhc2VTb3VyY2VcblxuICAgIGxldCBvcHRpb25zQnV0dG9uID0gY29tbWl0Y2hhbmdlLmdldFBhcmFtc0Zyb21CdXR0b24oZWxlbSlcbiAgICBsZXQgb3B0aW9ucyA9IGNvbW1pdGNoYW5nZS5nZXRQYXJhbXNGcm9tVXJsKFtcInV0bV9jYW1wYWlnblwiLFwidXRtX2NvbnRlbnRcIixcInV0bV9zb3VyY2VcIixcInV0bV9tZWRpdW1cIixcImZpcnN0X25hbWVcIixcImxhc3RfbmFtZVwiLFwiY291bnRyeVwiLFwicG9zdGFsX2NvZGVcIixcImFkZHJlc3NcIixcImNpdHlcIl0pXG4gICAgZm9yICh2YXIgYXR0ciBpbiBvcHRpb25zQnV0dG9uKSB7IG9wdGlvbnNbYXR0cl0gPSBvcHRpb25zQnV0dG9uW2F0dHJdOyB9XG4gICAgbGV0IHBhcmFtcyA9IFtdXG4gICAgZm9yKGxldCBrZXkgaW4gb3B0aW9ucykge1xuICAgICAgcGFyYW1zLnB1c2goa2V5ICsgJz0nICsgb3B0aW9uc1trZXldKVxuICAgIH1cbiAgICBzb3VyY2UgKz0gXCImXCIgKyBwYXJhbXMuam9pbihcIiZcIilcblxuICAgIGlmKGVsZW0uaGFzQXR0cmlidXRlKCdkYXRhLWVtYmVkZGVkJykpIHtcbiAgICAgIHNvdXJjZSArPSAnJm1vZGU9ZW1iZWRkZWQnXG4gICAgICBsZXQgaWZyYW1lID0gY29tbWl0Y2hhbmdlLmNyZWF0ZUlmcmFtZShzb3VyY2UpXG4gICAgICBlbGVtLmFwcGVuZENoaWxkKGlmcmFtZSlcbiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2NvbW1pdGNoYW5nZS1pZnJhbWUtZW1iZWRkZWQnKVxuICAgICAgY29tbWl0Y2hhbmdlLmlmcmFtZXMucHVzaChpZnJhbWUpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNob3cgdGhlIENvbW1pdENoYW5nZS1icmFuZGVkIGJ1dHRvbiBpZiBpdCdzIG5vdCBzZXQgdG8gY3VzdG9tLlxuICAgICAgaWYoIWVsZW0uaGFzQXR0cmlidXRlKCdkYXRhLWN1c3RvbScpICYmICFlbGVtLmhhc0F0dHJpYnV0ZSgnZGF0YS1jdXN0b20tYnV0dG9uJykpIHtcbiAgICAgICAgbGV0IGJ0bl9pZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKVxuICAgICAgICBsZXQgYnRuX3NyYyA9IGZ1bGxIb3N0ICsgXCIvbm9ucHJvZml0cy9cIiArIG5vbnByb2ZpdElEICsgXCIvYnRuXCJcbiAgICAgICAgaWYoZWxlbS5oYXNBdHRyaWJ1dGUoJ2RhdGEtZml4ZWQnKSkgeyBidG5fc3JjICs9ICc/Zml4ZWQ9dCcgfVxuICAgICAgICBidG5faWZyYW1lLnNyYyA9IGJ0bl9zcmNcbiAgICAgICAgYnRuX2lmcmFtZS5jbGFzc05hbWUgPSAnY29tbWl0Y2hhbmdlLWJ0bi1pZnJhbWUnXG4gICAgICAgIGJ0bl9pZnJhbWUuc2V0QXR0cmlidXRlKCdzY3JvbGxpbmcnLCAnbm8nKVxuICAgICAgICBidG5faWZyYW1lLnNldEF0dHJpYnV0ZSgnc2VhbWxlc3MnLCAnc2VhbWxlc3MnKVxuICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGJ0bl9pZnJhbWUpXG4gICAgICAgIGJ0bl9pZnJhbWUub25jbGljayA9IGNvbW1pdGNoYW5nZS5vcGVuRG9uYXRpb25Nb2RhbChpZnJhbWUsIG92ZXJsYXkpXG4gICAgICB9XG4gICAgICAvLyBDcmVhdGUgdGhlIGlmcmFtZSBvdmVybGF5IGZvciB0aGlzIGJ1dHRvblxuICAgICAgbGV0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICAgIG1vZGFsLmNsYXNzTmFtZSA9ICdjb21taXRjaGFuZ2UtbW9kYWwnXG4gICAgICBsZXQgb3ZlcmxheSA9IGNvbW1pdGNoYW5nZS5vdmVybGF5KClcbiAgICAgIGxldCBpZnJhbWVcbiAgICAgIGlmKGNvbW1pdGNoYW5nZS5tb2RhbElmcmFtZSkge1xuICAgICAgICBpZnJhbWUgPSBjb21taXRjaGFuZ2UubW9kYWxJZnJhbWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmcmFtZSA9IGNvbW1pdGNoYW5nZS5jcmVhdGVJZnJhbWUoc291cmNlKVxuICAgICAgICBjb21taXRjaGFuZ2UuaWZyYW1lcy5wdXNoKGlmcmFtZSlcbiAgICAgICAgY29tbWl0Y2hhbmdlLm1vZGFsSWZyYW1lID0gaWZyYW1lXG4gICAgICB9XG4gICAgICBtb2RhbC5hcHBlbmRDaGlsZChvdmVybGF5KVxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpXG4gICAgICBlbGVtLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQobW9kYWwpXG4gICAgICBvdmVybGF5Lm9uY2xpY2sgPSBjb21taXRjaGFuZ2UuaGlkZURvbmF0aW9uXG4gICAgICBlbGVtLm9uY2xpY2sgPSBjb21taXRjaGFuZ2Uub3BlbkRvbmF0aW9uTW9kYWwoaWZyYW1lLCBvdmVybGF5KVxuICAgIH0gLy8gZW5kIGVsc2VcbiAgfSAvLyBlbmQgZm9yIGxvb3Bcbn1cblxuLy8gTG9hZCB0aGUgQ1NTIGZvciB0aGUgcGFyZW50IHBhZ2UgZWxlbWVudCBmcm9tIG91ciBBV1Mgc2VydmVyXG5jb21taXRjaGFuZ2UubG9hZFN0eWxlc2hlZXQgPSAoKSA9PiB7XG4gIGlmKGNvbW1pdGNoYW5nZS5hbHJlYWR5U3R5bGVkKSByZXR1cm5cbiAgZWxzZSBjb21taXRjaGFuZ2UuYWxyZWFkeVN0eWxlZCA9IHRydWVcbiAgbGV0IHN0eWxlc2hlZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJylcbiAgc3R5bGVzaGVldC5ocmVmID0gXCJSRVBMQUNFX0NTU19VUkxcIlxuICBzdHlsZXNoZWV0LnJlbCAgPSAnc3R5bGVzaGVldCdcbiAgc3R5bGVzaGVldC50eXBlID0gJ3RleHQvY3NzJ1xuICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHN0eWxlc2hlZXQpXG59XG5cblxuLy8gSGFuZGxlIGlmcmFtZSBwb3N0IG1lc3NhZ2VzXG5pZih3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChlKSA9PiB7XG4gICAgLy8gQ2xvc2UgdGhlIG1vZGFsXG4gICAgaWYoZS5kYXRhID09PSAnY29tbWl0Y2hhbmdlOmNsb3NlJykge1xuICAgICAgY29tbWl0Y2hhbmdlLmhpZGVEb25hdGlvbigpXG4gICAgfSBcbiAgICAvLyBSZWRpcmVjdCBvbiBkb25hdGlvbiBjb21wbGV0aW9uIHVzaW5nIHRoZSByZWRpcmVjdCBwYXJhbVxuICAgIGVsc2UgaWYoZS5kYXRhLm1hdGNoKC9eY29tbWl0Y2hhbmdlOnJlZGlyZWN0LykpIHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBlLmRhdGEubWF0Y2goL15jb21taXRjaGFuZ2U6cmVkaXJlY3Q6KC4rKSQvKVxuICAgICAgaWYobWF0Y2hlcy5sZW5ndGggPT09IDIpIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWF0Y2hlc1sxXVxuICAgIH1cbiAgfSlcbn1cblxuLy8gTWFrZSBpbml0aWFsaXphdGlvbiBjYWxscyBvbiBkb2N1bWVudCBsb2FkXG5pZihkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIChldmVudCkgPT4ge1xuICAgIGNvbW1pdGNoYW5nZS5sb2FkU3R5bGVzaGVldCgpXG4gICAgY29tbWl0Y2hhbmdlLmFwcGVuZE1hcmt1cCgpXG4gIH0pXG59IGVsc2UgaWYod2luZG93LmpRdWVyeSkge1xuICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgY29tbWl0Y2hhbmdlLmxvYWRTdHlsZXNoZWV0KClcbiAgICBjb21taXRjaGFuZ2UuYXBwZW5kTWFya3VwKClcbiAgfSlcbn0gZWxzZSB7XG4gIHdpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgY29tbWl0Y2hhbmdlLmxvYWRTdHlsZXNoZWV0KClcbiAgICBjb21taXRjaGFuZ2UuYXBwZW5kTWFya3VwKClcbiAgfVxufVxuXG5pZihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tbWl0Y2hhbmdlLWRvbmF0ZScpKSB7XG4gIGNvbW1pdGNoYW5nZS5sb2FkU3R5bGVzaGVldCgpXG4gIGNvbW1pdGNoYW5nZS5hcHBlbmRNYXJrdXAoKVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vY2xpZW50L2pzL3dpZGdldC9kb25hdGUtYnV0dG9uLnYyLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==